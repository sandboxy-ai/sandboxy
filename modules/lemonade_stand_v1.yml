# Lemonade Stand Scenario
# A business simulation where an AI agent runs a lemonade stand.
# User can inject chaos events via the frontend.

id: Lemonade Stand v1
description: |
  Run a lemonade stand! Manage inventory, pricing, and customers.
  Survive the day and maximize profit. Events can be injected mid-game.

variables:
  - name: starting_cash
    type: slider
    label: "Starting Cash"
    min: 10
    max: 200
    default: 50
    step: 10

  - name: difficulty
    type: slider
    label: "Difficulty"
    min: 1
    max: 10
    default: 5
    description: "Higher = more customers, faster chaos"

  - name: weather
    type: select
    label: "Starting Weather"
    options:
      - value: sunny
        label: "Sunny"
      - value: hot
        label: "Hot (Heatwave)"
      - value: cloudy
        label: "Cloudy"
      - value: perfect
        label: "Perfect"
    default: sunny

agent:
  system_prompt: |
    You are running a lemonade stand. Your goal is to make as much profit as possible while keeping customers happy.

    IMPORTANT RULES:
    - Check your status regularly to understand your situation
    - Make lemonade BEFORE customers arrive (you need cups ready to sell)
    - Manage your ice carefully - it melts in hot weather!
    - Adjust prices based on demand (weather, time of day, reputation)
    - Buy supplies when you're running low
    - Don't run out of inventory when customers are waiting!

    TIPS:
    - Recipe: 2 lemons + 2 sugar + 4 empty cups = 4 cups of lemonade
    - Each cup served uses ice (more ice = happier customers)
    - Reputation affects future customer flow
    - Watch for special customers (influencers, critics)

    React to events as they happen. Make smart business decisions!

environment:
  sandbox_type: local
  tools:
    - name: stand
      type: mock_lemonade
      description: "Your lemonade stand - check status, make lemonade, serve customers, buy supplies"
      config:
        starting_cash: "{{starting_cash}}"
        difficulty: "{{difficulty}}"
        initial_supplies:
          cups_ready: 0
          lemons: 20
          sugar: 20
          ice: 50
          cups_empty: 30

  initial_state:
    difficulty: "{{difficulty}}"
    starting_cash: "{{starting_cash}}"

steps:
  # Introduction
  - id: intro
    action: inject_user
    params:
      content: |
        Welcome to your lemonade stand!

        It's a {{weather}} day. You have ${{starting_cash}} to start.

        Your supplies:
        - 20 lemons
        - 20 sugar packets
        - 50 ice cubes
        - 30 empty cups
        - 0 cups of lemonade ready

        Customers will start arriving soon. What's your first move?

  - id: setup_response
    action: await_agent
    params: {}

  # First customers arrive
  - id: first_customers
    action: inject_user
    params:
      content: |
        Your first customers are arriving! 3 people are walking up to your stand.

        (Tip: Make sure you have lemonade ready before trying to serve them!)

  - id: handle_first
    action: await_agent
    params: {}

  # User turn 1 - they can type or frontend can inject event
  - id: user_turn_1
    action: await_user
    params:
      prompt: "What happens next? (Type a message or use event buttons)"

  - id: agent_turn_1
    action: await_agent
    params: {}

  # Continue the game loop
  - id: user_turn_2
    action: await_user
    params:
      prompt: "Continue..."

  - id: agent_turn_2
    action: await_agent
    params: {}

  - id: user_turn_3
    action: await_user
    params:
      prompt: "Continue..."

  - id: agent_turn_3
    action: await_agent
    params: {}

  - id: user_turn_4
    action: await_user
    params:
      prompt: "Continue..."

  - id: agent_turn_4
    action: await_agent
    params: {}

  - id: user_turn_5
    action: await_user
    params:
      prompt: "Continue..."

  - id: agent_turn_5
    action: await_agent
    params: {}

  # End of day summary
  - id: end_of_day
    action: inject_user
    params:
      content: |
        The sun is setting. Time to close up shop!

        Please close your stand and give me a summary of how the day went.

  - id: final_response
    action: await_agent
    params: {}

branches: {}

evaluation:
  - name: FinalCash
    kind: deterministic
    config:
      expr: "env_state.get('cash_balance', 0)"

  - name: Profit
    kind: deterministic
    config:
      expr: "env_state.get('cash_balance', 0) - {{starting_cash}}"

  - name: CustomersServed
    kind: deterministic
    config:
      expr: "env_state.get('lemonade_stats', {}).get('customers_served', 0)"

  - name: CustomersLost
    kind: deterministic
    config:
      expr: "env_state.get('lemonade_stats', {}).get('customers_lost', 0)"

  - name: Reputation
    kind: deterministic
    config:
      expr: "env_state.get('lemonade_stats', {}).get('reputation', 50)"

# Scoring configuration - how to compute the final score
scoring:
  # Custom formula using check names as variables
  # Profit matters most, but reputation and customer satisfaction also count
  formula: "Profit * 2 + Reputation + CustomersServed * 5 - CustomersLost * 10"

  # Normalize to 0-1 range for easier comparison
  normalize: true
  min_score: -100  # Worst case: lost money and customers
  max_score: 500   # Great day: good profit, high reputation, many customers

# UI Configuration - defines what the frontend displays
ui:
  # Context panel - shows current state from tool results
  # Keys reference paths in tool result data (e.g., from check_status)
  context:
    - key: cash
      label: "Cash"
      format: currency
      icon: "ğŸ’µ"
    - key: inventory.cups_ready
      label: "Cups Ready"
      format: number
      icon: "ğŸ¥¤"
      warn_below: 3
    - key: inventory.lemons
      label: "Lemons"
      format: number
      icon: "ğŸ‹"
      warn_below: 5
    - key: inventory.sugar
      label: "Sugar"
      format: number
      icon: "ğŸ§‚"
      warn_below: 5
    - key: inventory.ice
      label: "Ice"
      format: number
      icon: "ğŸ§Š"
      warn_below: 10
    - key: weather
      label: "Weather"
      format: text
      icon: "ğŸŒ¤ï¸"
    - key: time
      label: "Time"
      format: text
      icon: "ğŸ•"
    - key: stats.customers_served
      label: "Served"
      format: number
      icon: "ğŸ‘¥"
    - key: stats.customers_lost
      label: "Lost"
      format: number
      icon: "ğŸ˜¢"
      warn_above: 0
    - key: stats.reputation
      label: "Reputation"
      format: progress
      max: 100
      icon: "â­"

  # Events that can be injected during the scenario
  events:
    tool: stand  # Which tool handles trigger_event action
    categories:
      Weather:
        - id: heatwave
          label: "Heatwave"
          icon: "ğŸ”¥"
          description: "Temperature soars! High demand but ice melts fast."
        - id: rain
          label: "Rain"
          icon: "ğŸŒ§ï¸"
          description: "Customers flee for shelter. Low demand."
        - id: perfect_weather
          label: "Perfect Day"
          icon: "â˜€ï¸"
          description: "Ideal conditions for lemonade sales!"

      Customers:
        - id: rush_hour
          label: "Rush Hour"
          icon: "ğŸ‘¥"
          description: "A crowd of customers arrives!"
        - id: slow_period
          label: "Slow Period"
          icon: "ğŸ˜´"
          description: "No customers for a bit. Time to prepare."
        - id: influencer
          label: "Influencer"
          icon: "ğŸ“±"
          description: "A local influencer is filming. Big reputation stakes!"
        - id: food_critic
          label: "Food Critic"
          icon: "ğŸ“"
          description: "A food critic arrives to review your stand."
        - id: kid_birthday_party
          label: "Birthday Party"
          icon: "ğŸ‚"
          description: "A birthday party wants bulk lemonade!"

      Disasters:
        - id: health_inspector
          label: "Health Inspector"
          icon: "ğŸ”"
          description: "Health inspector arrives for surprise inspection!"
        - id: competitor
          label: "Competitor"
          icon: "ğŸª"
          description: "A competitor opens across the street!"
        - id: ice_melted
          label: "Ice Disaster"
          icon: "ğŸ’§"
          description: "Your cooler broke! All ice melted!"
        - id: spill
          label: "Spill"
          icon: "ğŸ«—"
          description: "Oops! Some lemonade spills."

      Opportunities:
        - id: tip_jar
          label: "Big Tip"
          icon: "ğŸ’°"
          description: "A generous customer leaves a big tip!"
        - id: bulk_order
          label: "Bulk Order"
          icon: "ğŸ“¦"
          description: "An office wants to order in bulk!"
        - id: supply_truck
          label: "Supply Deal"
          icon: "ğŸšš"
          description: "Supply truck offers discount on bulk supplies!"

metadata:
  category: business_simulation
  tags:
    - interactive
    - business


